# hw definition file for processing by chibios_hwdef.py
# for H743 bootloader

# MCU class and specific type
MCU STM32H7xx STM32H743xx

# crystal frequency
OSCILLATOR_HZ 16000000

# board ID for firmware load
APJ_BOARD_ID 1050

FLASH_SIZE_KB 2048
#128K for bootloader and 256K for param storage(what a waste of storage!)
FLASH_RESERVE_START_KB 384

#beeper
PA0 TIM2_CH1  TIM2 GPIO(1) ALARM 
define HAL_HAVE_PIXRACER_LED
define HAL_GPIO_LED_ON  0
define HAL_GPIO_LED_OFF 1
PA3 LED_R OUTPUT HIGH GPIO(2)
PA2 LED_G OUTPUT HIGH GPIO(3)
PA1 LED_B OUTPUT HIGH GPIO(4)

PE6  TIM15_CH2 TIM15 PWM(1)  GPIO(50)
PE5  TIM15_CH1 TIM15 PWM(2)  GPIO(51)
PB5  TIM3_CH2  TIM3  PWM(3)  GPIO(52)
PB4  TIM3_CH1  TIM3  PWM(4)  GPIO(53)
PC7  TIM8_CH2  TIM8  PWM(5)  GPIO(54)
PC6  TIM8_CH1  TIM8  PWM(6)  GPIO(55)
PD15 TIM4_CH4  TIM4  PWM(7)  GPIO(56)
PD14 TIM4_CH3  TIM4  PWM(8)  GPIO(57)
#trig
PB14 TIM12_CH1 TIM12  PWM(9)  GPIO(58) NODMA
#echo
PB15 TIM12_CH2 TIM12  PWM(10) GPIO(59) NODMA


define HAL_GPIO_A_LED_PIN 2
define HAL_GPIO_B_LED_PIN 3
define HAL_GPIO_C_LED_PIN 4

PA8 TIM1_CH1 TIM1 RCININT FLOAT LOW


# order of UARTs (and USB)
SERIAL_ORDER OTG1 USART1 USART3 UART5 UART7 UART8 USART2

PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD
# USART1 is telem1
PA10 USART1_RX USART1
PA9 USART1_TX USART1

# USART3 is telem2
PD9 USART3_RX USART3
PD8 USART3_TX USART3

# UART5 is GPS1
PB12 UART5_RX UART5
PB13 UART5_TX UART5


# UART7 is GPS2
PE7 UART7_RX UART7
PE8 UART7_TX UART7

# UART8 is Debug
PE0 UART8_RX UART8
PE1 UART8_TX UART8

# USART2 is rcin
PD6 USART2_RX USART2 NODMA
define HAL_SERIAL6_PROTOCOL SerialProtocol_RCIN
define HAL_SERIAL6_BAUD 115


#128 K BYTES PER SECTOR FLASH
define HAL_STORAGE_SIZE 16384
define HAL_WITH_RAMTRON 0
#num starts from 0,use page1&2 for param stroage
define STORAGE_FLASH_PAGE 1

PC8  SDMMC1_D0 SDMMC1
PC9  SDMMC1_D1 SDMMC1
PC10 SDMMC1_D2 SDMMC1
PC11 SDMMC1_D3 SDMMC1
PC12 SDMMC1_CK SDMMC1
PD2  SDMMC1_CMD SDMMC1

define HAL_OS_FATFS_IO 1
define HAL_BOARD_LOG_DIRECTORY "/APM/LOGS"
define HAL_BOARD_TERRAIN_DIRECTORY "/APM/TERRAIN"


define HAL_SPI_CHECK_CLOCK_FREQ

# sensor CS
#SENSOR4
PA4 AK8975_CS CS
#SENSOR1
PE15 BMI088_CS_G CS
#SENSOR2
PB11 BMI088_CS_A CS
#SENSOR3
PB10 SPL06_CS CS

PB0 LED1 OUTPUT LOW
PB7 LED2 OUTPUT LOW

# SPI1
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

# SPI4
PE12 SPI4_SCK SPI4
PE13 SPI4_MISO SPI4
PE14 SPI4_MOSI SPI4

# SPI devices
SPIDEV bmi088_a       SPI1 DEVID1  BMI088_CS_A     MODE3  10*MHZ 10*MHZ
SPIDEV bmi088_g       SPI1 DEVID2  BMI088_CS_G     MODE3  10*MHZ 10*MHZ
SPIDEV spl06          SPI1 DEVID3  SPL06_CS        MODE3  2*MHZ 2*MHZ
SPIDEV ak8975         SPI1 DEVID4  AK8975_CS       MODE3  1*MHZ 1*MHZ
# Order of I2C buses
I2C_ORDER I2C1

# First I2C bus.
PB8 I2C1_SCL I2C1
PB9 I2C1_SDA I2C1

# analog in
PC1 BATT_VOLTAGE_SENS ADC1 NODMA SCALE(1)
PC0 BATT_CURRENT_SENS ADC1 NODMA SCALE(1)
define HAL_BATT_VOLT_PIN 11
define HAL_BATT_CURR_PIN 10
define HAL_BATT_VOLT_SCALE 10.1
define HAL_BATT_CURR_SCALE 17.0

define ALLOW_ARM_NO_COMPASS
# define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE

# probe for an invensense IMU
IMU BMI088 SPI:bmi088_a SPI:bmi088_g ROTATION_ROLL_180
COMPASS AK8975 SPI:ak8975 true ROTATION_YAW_270
define HAL_PROBE_EXTERNAL_I2C_COMPASSES
define HAL_COMPASS_AUTO_ROT_DEFAULT 2
define HAL_DEFAULT_INS_FAST_SAMPLE 1
# and ms5611 baro
BARO SPL06 SPI:spl06
#BARO Dummy
define HAL_HAVE_IMU_HEATER 1
define HAL_IMU_TEMP_DEFAULT 45
PB1 HEATER OUTPUT LOW GPIO(0)
define HAL_HEATER_GPIO_PIN 0
